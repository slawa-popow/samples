<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto&family=Rubik:wght@300;400&family=Tiro+Gurmukhi&display=swap" rel="stylesheet">

    <title>Document</title>
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/brython@3.10.6/brython.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/brython@3.10.6/brython_stdlib.js"
    ></script>

    <style>
        html {
            font-family: 'Rubik', sans-serif;
            font-size: 0.9em;
        }
        .lcontent {
            margin: 20px 0;
            padding: 0 20px;
            width: 500px;
            height: 400px;
            border: 1px solid rgba(72, 114, 230, 0.493);
            float: left;
        }
        .cntcontent {
            width: 20px;            
            float: left;
            margin: 20px 20px;
        }
        .rcontent {
            margin: 20px 0;
            padding: 20 20px;
            width: 500px;
            height: 400px;
            border: 1px solid rgba(72, 114, 230, 0.493);
            float: left; 
            
        }
        .bcontent {
            clear: both;
            width: 97%;
            padding: 20px 20px;
            border: 1px solid rgba(52, 216, 65, 0.493);
        }
        table {
            width: 100%;
        }
        table td {
            width: 50%;
            padding: 5px 0;
        }
        .label {
            display: block;
            text-align: center;
            padding: 5px 0;
            margin: 5px 0;
            margin-bottom: 5px;
            background-color: rgba(26, 95, 175, 0.925);
            color: rgb(255, 254, 254);
        }
        .info {
            display: block;
            text-align: center;
            padding: 5px 0;
            margin: 5px 0;
            margin-bottom: 5px;
            background-color: rgba(26, 175, 143, 0.555);
            color: black;
            font-size: 1.1em;
            font-weight: bold;
        }
        #start-heat{
            box-shadow:inset 0px 1px 0px 0px #9acc85;
            background:linear-gradient(to bottom, #74ad5a 5%, #68a54b 100%);
            background-color:#74ad5a;
            border-radius: 5px;
            border:1px solid #3b6e22;
            display:inline-block;
            cursor:pointer;
            color:#ffffff;
            padding:10px 16px;
            font-size: 1em;
            text-decoration:none;
        }
        #start-heat:hover {
            background:linear-gradient(to bottom, #68a54b 5%, #74ad5a 100%);
            background-color:#68a54b;
        }
        #start-heat:active {
            position:relative;
            top:1px;
        }
        #stop-heat {
            box-shadow:inset 0px 1px 0px 0px #cf866c;
            background:linear-gradient(to bottom, #d0451b 5%, #bc3315 100%);
            background-color:#d0451b;
            border-radius:5px;
            border:1px solid #942911;
            display:inline-block;
            cursor:pointer;
            color:#ffffff;
            font-size: 1em;
            padding:10px 16px;
            text-decoration:none;
            text-shadow:0px 1px 0px #854629;
        }
        #stop-heat:hover {
            background:linear-gradient(to bottom, #bc3315 5%, #d0451b 100%);
            background-color:#bc3315;
        }
        #stop-heat:active {
            position:relative;
            top:1px;
        }
        button {
            box-shadow:inset 0px 1px 0px 0px #a6827e;
            background:linear-gradient(to bottom, #7d5d3b 5%, #634b30 100%);
            background-color:#7d5d3b;
            border-radius:5px;
            border:1px solid #54381e;
            display:inline-block;
            cursor:pointer;
            color:#ffffff;
            font-size:1em;
            padding:10px 16px;
            text-decoration:none;
        }
        button:hover {
            background:linear-gradient(to bottom, #634b30 5%, #7d5d3b 100%);
            background-color:#634b30;
        }
        button:active {
            position:relative;
            top:1px;
        }
        input {
            height: 28px;
            font-size: 1.1em;
        }


    </style>
  </head>


<body onload="brython(1)">
<div class="lcontent">
    <svg width="550" height="450" viewBox="0 0 250 150" xmlns="http://www.w3.org/2000/svg" xmlns:bx="https://boxy-svg.com">
        <defs></defs>
        <g id="termostat-1">
          <path style="fill: rgb(216, 216, 216); stroke: rgba(0, 0, 0, 0.56);" d="M 22 38 H 37 V 133 A 5 5 0 0 1 32 138 H 27 A 5 5 0 0 1 22 133 V 38 Z" id="tube-1" bx:shape="rect 22 38 15 100 0 0 5 5 1@8a75a968"></path>
          <rect x="27" y="13" width="4.488" height="25" style="stroke-width: 0px; stroke: rgb(9, 9, 9); fill: rgba(61, 61, 61, 0.96);" bx:origin="0.5 0.48059"></rect>
          <text style="fill: rgb(51, 51, 51); font-family: Arial, sans-serif; font-size: 7px; white-space: pre;" x="51.156" y="41.925" id="termo1">термопара #1<tspan x="51.15599822998047" dy="1em">​</tspan></text>
          <text style="fill: rgb(51, 51, 51); font-family: Arial, sans-serif; font-size: 7px; white-space: pre;" x="51.156" y="55.375" id="value-temp1">t = 0 </text>
        </g>
        <g id="termostat-2">
          <path style="fill: rgb(216, 216, 216); stroke: rgba(0, 0, 0, 0.56);" d="M 119.61 37.616 H 134.61 V 132.616 A 5 5 0 0 1 129.61 137.616 H 124.61 A 5 5 0 0 1 119.61 132.616 V 37.616 Z" id="tube-2" bx:shape="rect 119.61 37.616 15 100 0 0 5 5 1@5d70c48e"></path>
          <rect x="124.61" y="12.616" width="4.488" height="25" style="stroke-width: 0px; stroke: rgb(9, 9, 9); fill: rgba(61, 61, 61, 0.96);" bx:origin="0.5 0.48059"></rect>
          <text style="fill: rgb(51, 51, 51); font-family: Arial, sans-serif; font-size: 7px; white-space: pre;" x="51.156" y="41.925" id="termo2" transform="matrix(1, 0, 0, 1, 97.610428, -0.384293)">термопара #2<tspan x="51.15599822998047" dy="1em">​</tspan></text>
          <text style="fill: rgb(51, 51, 51); font-family: Arial, sans-serif; font-size: 7px; white-space: pre;" x="148.766" y="54.991" id="value-temp2">t = 0 </text>
        </g>
      </svg>
</div>
<div class="cntcontent"></div>

<div class="rcontent">
<span class="label">Линейный нагрев</span>
<table>
    
    <tr>
        <td>
            <button id="start-heat">включить нагрев</button>
        </td>
        <td>
            <button id="stop-heat">стоп нагрев</button>
        </td>
    </tr>
    <tr>
        <td colspan="2"><span class="info">стоп</span></td>
    </tr>
    <tr>
        <td colspan="2"><span class="label">время нагрева термопар</span></td>
    </tr>
    <tr>
        <td>
            <button id="set-temp-sensor1">#1 нагреть до:</button>
        </td>
        <td>
            <input id="value-temp-sensor1" type="text" size="10" value="150">
        </td>
    </tr>
    <tr>
        <td>
            <button id="set-temp-sensor2">#2 нагреть до:</button>
        </td>
        <td>
            <input id="value-temp-sensor2" type="text" size="10" value="272">
        </td>
    </tr>
    <tr>
        <td><button id="set-time-heat">время нагрева сек.:</button></td>
        <td><input id="value-time-heat" type="text" size="10" value="10"></td>
    </tr>
    <tr>
        <td colspan="2"><span class="info">--</span></td>
    </tr>
</table>
</div>
<div class="bcontent"></div>
<script type="text/python">
    from browser import document, window, html, bind

    # айди svg: g#1 - "termostat-1"; корпус термопары #1 - "tube-1"; 
    #              текст номер термопары - "termo1"; текст текущ. температура - "value-temp1" ;
    # айди svg: g#2 - "termostat-2"; корпус термопары #2 - "tube-2";
    #              текст номер термопары - "termo2";  текст текущ. температура - "value-temp2";
    #
    # айди кнопок: #start-heat - включить нагрев; #stop-heat - стоп нагрев; 
    #               #set-temp-sensor1 - нагреть тепмопару #1 до температуры;
    #               #set-temp-sensor2 - нагреть тепмопару #2 до температуры;
    #               #set-time-heat - время нагрева термопар до 300 градусов (макс.);
    #
    # айди полей ввода: #value-temp-sensor1 - макс. нагрев термопары #1;
    #                   #value-temp-sensor2 - макс. нагрев термопары #2;
    #                   #value-time-heat - ввод времени нагрева термопар;



    class Termostat:
        """Класс svg группы термопары"""

        __slots__: tuple = ("_id_g", "_fill", "_cold_fill", "_heat_fill", "_svg_g_obj", "_max_temp", 
                            "_current_temp", "_name_text", "_value_text", "_svg_fill_obj", "info", "_id_fill"
                        )


        def __init__(self, id_svg: tuple) -> None:
            self._id_g, self._id_fill = id_svg

            # объекты svg группы и корпуса термопары
            self._svg_g_obj = document[self._id_g]
            self._svg_fill_obj = document[self._id_fill]

            # объект <span> .info
            self.info = document.querySelector(".info")

            # цвет холодной термопары. цвет беру прямо из объектa
            self._cold_fill: tuple = (216, 216, 216)

            # текущий изменяющийся цвет корпуса. сначала равен холодному (серый)
            self._fill = self._cold_fill

            # явно цвет горячей термопары. из серого в красный делаем уменьшением до нуля 2 и 3 числа
            # например: rgb(216, 0, 0) - красный. rgb(216, 216, 216) - серый
            self._heat_fill: tuple = (216, 0, 0)

            # температура при которой сработает выходное реле. Равно нан пока.
            self._max_temp = None

            # текущая температура
            self._current_temp = 0

            # текст имя термопары #n. объект. первый из списка дочерних текстовых элементов. для доступа к самому тексту: self._name_text.text 
            self._name_text = self._svg_g_obj.select("text")[0]

            # текст текущее значение температуры
            self._value_text = self._svg_g_obj.select("text")[1]



        @property
        def color(self) -> str:
            """цвет копуса термопары"""
            
            return self._fill


        @color.setter
        def color (self, value: tuple) -> None:
            """установить цвет термопаты. принимает кортеж rgb чисел."""

            try:
                r, g, b = value
                self._svg_fill_obj.style["fill"] = f"rgb({int(r)}, {int(g)}, {int(b)})"
            except ValueError:
                self.info.innerHTML = "не числовые значения кода rgb."
            else:
                self.info.innerHTML = "--"


        @property
        def temp(self) -> str:
            """текущая температура"""

            return self._current_temp


        @temp.setter
        def temp(self, value: int) -> None:
            self._value_text.text = f"t = {str(value)}"
            # self._value_text.style["fill"] = "green"

        def cold_color(self) -> tuple:
            return self._cold_fill


    trm = Termostat(("termostat-1", "tube-1"))
    animation = None
    def chcolor(trm, step):
        r = 216
        g = 216
        b = 216
        t = 0
        global animation
        def animate(tm):
            global animation
            nonlocal r, g, b, t, step
            animation = window.requestAnimationFrame(animate)
            trm.temp = int(t*1.5)
            g -= step
            b -= step
            t += step
            trm.color = (r, g, b)
            if (g < 1) and (b < 1):
                step = 0
                window.cancelAnimationFrame(animation)
                trm.color = trm.cold_color()
                trm.temp = 0
                animation = None
        animate(1)
        


    @bind(document["start-heat"], "click")
    def newfill(e):
        global animation
        if animation is None:
            chcolor(trm, 0.5)

    @bind(document["stop-heat"], "click")
    def oldfill(e):
        global animation
        window.cancelAnimationFrame(animation)
        trm.color = trm.cold_color()
        trm.temp = 0
        animation = None

</script>

</body>
</html>
